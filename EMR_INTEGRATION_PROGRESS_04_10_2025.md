# üöÄ EMR Integration Module - Progress Report

**–î–∞—Ç–∞:** 04.10.2025  
**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** –ù–∏–∫  
**–ú–æ–¥—É–ª—å:** EMR Integration

---

## üìä –ü–†–û–î–ï–õ–ê–ù–ù–ê–Ø –†–ê–ë–û–¢–ê

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏:

#### 1. **Child-Pugh Score = "N/A"**
**–ü—Ä–æ–±–ª–µ–º–∞:** Child-Pugh Score –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª—Å—è, –≤—Å–µ–≥–¥–∞ –±—ã–ª–æ "N/A"  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç Child-Pugh Score –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∏–ª–∏—Ä—É–±–∏–Ω–∞
- –ë–∏–ª–∏—Ä—É–±–∏–Ω < 2.0 ‚Üí Class A (–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –ø–µ—á–µ–Ω—å)
- –ë–∏–ª–∏—Ä—É–±–∏–Ω 2.0-3.0 ‚Üí Class B (—É–º–µ—Ä–µ–Ω–Ω–∞—è –¥–∏—Å—Ñ—É–Ω–∫—Ü–∏—è)
- –ë–∏–ª–∏—Ä—É–±–∏–Ω > 3.0 ‚Üí Class C (—Ç—è–∂–µ–ª–∞—è –¥–∏—Å—Ñ—É–Ω–∫—Ü–∏—è)

**–§–∞–π–ª—ã:**
- `EmrIntegrationServiceImpl.java` - –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `calculateChildPughFromBilirubin()`
- –¢–µ–ø–µ—Ä—å Treatment Protocol –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Child-Pugh –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –¥–æ–∑

#### 2. **Height –∏ Weight = NULL**
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–æ—Å—Ç –∏ –≤–µ—Å –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–æ—Å—Ç–∞ (150-200 —Å–º) –∏ –≤–µ—Å–∞ (50-120 –∫–≥)

**–§–∞–π–ª—ã:**
- `MockEmrDataGenerator.java` - –¥–æ–±–∞–≤–ª–µ–Ω—ã LOINC –∫–æ–¥—ã 8302-2 (—Ä–æ—Å—Ç) –∏ 29463-7 (–≤–µ—Å)
- `EmrIntegrationServiceImpl.java` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–æ—Å—Ç–∞ –∏ –≤–µ—Å–∞ –≤ switch

**–ó–∞—á–µ–º –Ω—É–∂–Ω–æ:**
- –†–∞—Å—á–µ—Ç –¥–æ–∑—ã –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ (–º–Ω–æ–≥–∏–µ –¥–æ–∑—ã –Ω–∞ –∫–≥ –≤–µ—Å–∞)
- –†–∞—Å—á–µ—Ç GFR –ø–æ —Ñ–æ—Ä–º—É–ª–µ Cockcroft-Gault
- –ò–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ (BMI)

#### 3. **Insurance Policy Number = NULL**
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç—Ä–∞—Ö–æ–≤–æ–π –ø–æ–ª–∏—Å –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª—Å—è, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –≤ –ë–î  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ö–æ–≤–æ–≥–æ –ø–æ–ª–∏—Å–∞ –∏–∑ FHIR identifiers

**–§–∞–π–ª—ã:**
- `EmrIntegrationServiceImpl.java` - –¥–æ–±–∞–≤–ª–µ–Ω –∫–æ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—Ç—Ä–∞—Ö–æ–≤–æ–≥–æ –ø–æ–ª–∏—Å–∞ (20% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)

#### 4. **createdBy = "TODO: –≤–∑—è—Ç—å –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"**
**–ü—Ä–æ–±–ª–µ–º–∞:** @PrePersist –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª createdBy –Ω–∞ TODO  
**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ @PrePersist - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ null

**–§–∞–π–ª—ã:**
- `Patient.java` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω @PrePersist
- `Emr.java` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω @PrePersist
- `Vas.java` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω @PrePersist
- `Recommendation.java` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω @PrePersist

---

## ‚úÖ –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–ù–´–ï ENDPOINTS

### Endpoint 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 1 –º–æ–∫–æ–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ ‚úÖ
```
POST /api/emr/mock/generate?createdBy=nick
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–∞—Ü–∏–µ–Ω—Ç —Å 8 –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏

### Endpoint 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è batch –º–æ–∫–æ–≤—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ ‚úÖ
```
POST /api/emr/mock/generate-batch?count=10&createdBy=nick
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–µ—Ç—Å—è 10 –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### Endpoint 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ ‚úÖ
```
GET /api/emr/check-import/{fhirPatientId}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç

### Endpoint 4: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Observations ‚úÖ
```
POST /api/emr/convert-observations?createdBy=nick
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç FHIR Observations –≤ EmrDTO —Å —Ä–∞—Å—á–µ—Ç–æ–º GFR

### Endpoint 5: –ò–º–ø–æ—Ä—Ç –∏–∑ FHIR —Å–µ—Ä–≤–µ—Ä–∞ ‚úÖ
```
POST /api/emr/import/47235381?importedBy=nick
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** **–ü–ï–†–í–´–ô –£–°–ü–ï–•!** –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ü–∏–µ–Ω—Ç –∏–∑ HAPI FHIR Test Server
- Patient ID: 47235381
- –ò–º—è: Karla Nu√±ez
- –ò—Å—Ç–æ—á–Ω–∏–∫: http://hapi.fhir.org/baseR4

### Endpoint 6: –ü–æ–∏—Å–∫ –≤ FHIR ‚úÖ
```
GET /api/emr/search?firstName=Nu√±ez&lastName=Karla
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–∞–π–¥–µ–Ω–æ 10 –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ Karla Nu√±ez –≤ FHIR —Å–µ—Ä–≤–µ—Ä–µ

### Endpoint 7: –ü–æ–ª—É—á–µ–Ω–∏–µ Observations ‚ö†Ô∏è
```
GET /api/emr/observations/47235381
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ (—É –ø–∞—Ü–∏–µ–Ω—Ç–∞ –Ω–µ—Ç –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ FHIR)
**–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ –Ω—É–∂–µ–Ω –ø–∞—Ü–∏–µ–Ω—Ç —Å –¥–∞–Ω–Ω—ã–º–∏

---

## üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
- **8 –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π** –Ω–∞ –ø–∞—Ü–∏–µ–Ω—Ç–∞:
  1. –ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω ‚Üí GFR (—Ñ—É–Ω–∫—Ü–∏—è –ø–æ—á–µ–∫)
  2. –ë–∏–ª–∏—Ä—É–±–∏–Ω ‚Üí Child-Pugh Score (—Ñ—É–Ω–∫—Ü–∏—è –ø–µ—á–µ–Ω–∏)
  3. –¢—Ä–æ–º–±–æ—Ü–∏—Ç—ã (PLT)
  4. –õ–µ–π–∫–æ—Ü–∏—Ç—ã (WBC)
  5. –ù–∞—Ç—Ä–∏–π (Sodium)
  6. –°–∞—Ç—É—Ä–∞—Ü–∏—è (SpO2)
  7. –†–æ—Å—Ç (Height)
  8. –í–µ—Å (Weight)

### –ò–º–ø–æ—Ä—Ç –∏–∑ FHIR:
- ‚úÖ –£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ø–∞—Ü–∏–µ–Ω—Ç 47235381
- ‚úÖ –°–æ–∑–¥–∞–Ω –º–∞–ø–ø–∏–Ω–≥ external ‚Üí internal
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ –ë–î

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

#### EmrIntegrationServiceImpl.java
```java
private String calculateChildPughFromBilirubin(double bilirubin) {
    if (bilirubin < 2.0) return "A";
    else if (bilirubin < 3.0) return "B";
    else return "C";
}
```

#### MockEmrDataGenerator.java
```java
// –†–æ—Å—Ç (Height) - LOINC 8302-2
observations.add(createObservation(..., "8302-2", "Body Height", 150-200 cm));

// –í–µ—Å (Weight) - LOINC 29463-7
observations.add(createObservation(..., "29463-7", "Body Weight", 50-120 kg));
```

---

## üìã –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ò–º–ø–æ—Ä—Ç –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∏–∑ HAPI FHIR Test Server
- –ü–æ–∏—Å–∫ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –≤ FHIR
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Observations
- –†–∞—Å—á–µ—Ç GFR –∏–∑ –∫—Ä–µ–∞—Ç–∏–Ω–∏–Ω–∞
- –†–∞—Å—á–µ—Ç Child-Pugh –∏–∑ –±–∏–ª–∏—Ä—É–±–∏–Ω–∞
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ö–æ–≤–æ–≥–æ –ø–æ–ª–∏—Å–∞
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ createdBy

### ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ù–µ –≤—Å–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã –≤ HAPI FHIR –∏–º–µ—é—Ç Observations
- Child-Pugh —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —É–ø—Ä–æ—â–µ–Ω–Ω–æ (—Ç–æ–ª—å–∫–æ –ø–æ –±–∏–ª–∏—Ä—É–±–∏–Ω—É)
- –î–ª—è –ø–æ–ª–Ω–æ–≥–æ Child-Pugh –Ω—É–∂–Ω—ã: –∞–ª—å–±—É–º–∏–Ω, –ø—Ä–æ—Ç—Ä–æ–º–±–∏–Ω–æ–≤–æ–µ –≤—Ä–µ–º—è, –∞—Å—Ü–∏—Ç, —ç–Ω—Ü–µ—Ñ–∞–ª–æ–ø–∞—Ç–∏—è

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ –ù–∞–π—Ç–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞ —Å Observations –≤ HAPI FHIR
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∏–º–ø–æ—Ä—Ç–∞ —Å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Treatment Protocol –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è EmrIntegrationService
5. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìä –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –¢–∞–±–ª–∏—Ü—ã:
- `nurse_patients` - –ø–∞—Ü–∏–µ–Ω—Ç—ã (–º–æ–∫–æ–≤—ã–µ + FHIR)
- `emr` - –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∫–∞—Ä—Ç—ã —Å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- `emr_mappings` - –º–∞–ø–ø–∏–Ω–≥ external FHIR ID ‚Üí internal EMR number

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö:
- `MOCK_GENERATOR` - –º–æ–∫–æ–≤—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- `FHIR_SERVER` - —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã –∏–∑ HAPI FHIR

---

## üèÜ –î–û–°–¢–ò–ñ–ï–ù–ò–Ø

‚úÖ **–ü–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π –∏–º–ø–æ—Ä—Ç** –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ FHIR —Å–µ—Ä–≤–µ—Ä–∞  
‚úÖ **–ü–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (8 –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π)  
‚úÖ **–†–∞—Å—á–µ—Ç Child-Pugh Score** –¥–ª—è Treatment Protocol  
‚úÖ **–í—Å–µ 7 endpoints** –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ **4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–∞** –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã  

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 04.10.2025  
**–ê–≤—Ç–æ—Ä:** –ù–∏–∫  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ú–æ–¥—É–ª—å –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Treatment Protocol
