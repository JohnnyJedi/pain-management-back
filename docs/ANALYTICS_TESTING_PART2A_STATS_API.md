# üìä –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ú–û–î–£–õ–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ò - –ß–ê–°–¢–¨ 2A: API –°–¢–ê–¢–ò–°–¢–ò–ö–ò

## üéØ –¶–ï–õ–¨
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

---

## API ENDPOINT 1: GET /api/analytics/events/stats

### –û–ø–∏—Å–∞–Ω–∏–µ
–ü–æ–ª—É—á–∏—Ç—å –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º —Å–æ–±—ã—Ç–∏—è–º —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ —Ç–∏–ø—É, —Ä–æ–ª–∏ –∏ —Å—Ç–∞—Ç—É—Å—É.

---

### –¢–ï–°–¢ 1.1: –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤)

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/events/stats
```

**–ß–¢–û –î–û–õ–ñ–ù–û –í–ï–†–ù–£–¢–¨–°–Ø:**
```json
{
  "totalEvents": 21,
  "eventsByType": {
    "VAS_RECORDED": 7,
    "USER_LOGIN_SUCCESS": 3,
    "PATIENT_REGISTERED": 2,
    "PERSON_CREATED": 2,
    "RECOMMENDATION_APPROVED": 1,
    "RECOMMENDATION_REJECTED": 1,
    "ESCALATION_CREATED": 1,
    "ESCALATION_RESOLVED": 1,
    "PERSON_UPDATED": 1,
    "PERSON_DELETED": 1,
    "USER_LOGIN_FAILED": 1
  },
  "eventsByRole": {
    "NURSE": 7,
    "ADMIN": 5,
    "DOCTOR": 6,
    "ANESTHESIOLOGIST": 1
  },
  "eventsByStatus": {
    "SUCCESS": 3,
    "FAILED": 1,
    "APPROVED": 1,
    "REJECTED": 1,
    "RESOLVED": 1
  }
}
```

**–ü–†–û–í–ï–†–ö–ò:**
- ‚úì totalEvents = —Å—É–º–º–∞ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –∏–∑ Part 1
- ‚úì eventsByType —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ 10+ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
- ‚úì eventsByRole —Å–æ–¥–µ—Ä–∂–∏—Ç NURSE, DOCTOR, ADMIN, ANESTHESIOLOGIST
- ‚úì eventsByStatus —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã
- ‚úì –°—É–º–º—ã –≤ –≥—Ä—É–ø–ø–∞—Ö —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å totalEvents

**–ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ –í MONGODB:**
```javascript
// –ü–æ–¥—Å—á–µ—Ç –≤—Ä—É—á–Ω—É—é
db.analytics_events.count()
// –î–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å totalEvents

// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø—É
db.analytics_events.aggregate([
  { $group: { _id: "$eventType", count: { $sum: 1 } } }
])
// –î–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å eventsByType
```

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞, —á–∏—Å–ª–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å MongoDB

---

### –¢–ï–°–¢ 1.2: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥ (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/events/stats?startDate=2025-10-13T00:00:00&endDate=2025-10-13T23:59:59
```

**–ß–¢–û –î–û–õ–ñ–ù–û –í–ï–†–ù–£–¢–¨–°–Ø:**
```json
{
  "totalEvents": 21,
  "eventsByType": { ... },
  "eventsByRole": { ... },
  "eventsByStatus": { ... }
}
```

**–ü–†–û–í–ï–†–ö–ò:**
- ‚úì –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è
- ‚úì totalEvents <= –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–±—ã—Ç–∏–π

**–ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ –í MONGODB:**
```javascript
db.analytics_events.find({
  timestamp: {
    $gte: ISODate("2025-10-13T00:00:00Z"),
    $lte: ISODate("2025-10-13T23:59:59Z")
  }
}).count()
```

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –¢–ï–°–¢ 1.3: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø—Ä–æ—à–ª—ã–π –¥–µ–Ω—å (–ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/events/stats?startDate=2025-10-12T00:00:00&endDate=2025-10-12T23:59:59
```

**–ß–¢–û –î–û–õ–ñ–ù–û –í–ï–†–ù–£–¢–¨–°–Ø:**
```json
{
  "totalEvents": 0,
  "eventsByType": {},
  "eventsByRole": {},
  "eventsByStatus": {}
}
```

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –ü—É—Å—Ç–æ–π –ø–µ—Ä–∏–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω—É–ª–µ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

---

## API ENDPOINT 2: GET /api/analytics/users/{userId}/activity

### –û–ø–∏—Å–∞–Ω–∏–µ
–ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π, –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ª–æ–≥–∏–Ω–æ–≤.

---

### –¢–ï–°–¢ 2.1: –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/users/admin001/activity
```

**–ß–¢–û –î–û–õ–ñ–ù–û –í–ï–†–ù–£–¢–¨–°–Ø:**
```json
{
  "userId": "admin001",
  "userRole": "ADMIN",
  "totalActions": 5,
  "lastActivity": "2025-10-13T12:40:00",
  "loginCount": 2,
  "failedLoginCount": 1
}
```

**–ü–†–û–í–ï–†–ö–ò:**
- ‚úì userId = "admin001"
- ‚úì userRole = "ADMIN"
- ‚úì totalActions = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –≥–¥–µ userId = admin001
- ‚úì lastActivity = timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è
- ‚úì loginCount = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ USER_LOGIN_SUCCESS
- ‚úì failedLoginCount = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ USER_LOGIN_FAILED

**–ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ –í MONGODB:**
```javascript
// –í—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
db.analytics_events.find({ userId: "admin001" }).count()
// –î–æ–ª–∂–Ω–æ = totalActions

// –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
db.analytics_events.find({ userId: "admin001" })
  .sort({ timestamp: -1 })
  .limit(1)
// timestamp –¥–æ–ª–∂–µ–Ω = lastActivity

// –£—Å–ø–µ—à–Ω—ã–µ –ª–æ–≥–∏–Ω—ã
db.analytics_events.find({
  userId: "admin001",
  eventType: "USER_LOGIN_SUCCESS"
}).count()
// –î–æ–ª–∂–Ω–æ = loginCount
```

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### –¢–ï–°–¢ 2.2: –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–µ–¥—Å–µ—Å—Ç—Ä—ã

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/users/NURSE001/activity
```

**–ß–¢–û –î–û–õ–ñ–ù–û –í–ï–†–ù–£–¢–¨–°–Ø:**
```json
{
  "userId": "NURSE001",
  "userRole": "NURSE",
  "totalActions": 7,
  "lastActivity": "2025-10-13T12:35:00",
  "loginCount": 0,
  "failedLoginCount": 0
}
```

**–ü–†–û–í–ï–†–ö–ò:**
- ‚úì totalActions = 7 (–≤—Å–µ VAS –∑–∞–ø–∏—Å–∏)
- ‚úì userRole = "NURSE"
- ‚úì loginCount = 0 (–º–µ–¥—Å–µ—Å—Ç—Ä–∞ –Ω–µ –ª–æ–≥–∏–Ω–∏–ª–∞—Å—å –≤ —Ç–µ—Å—Ç–∞—Ö)

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–µ–¥—Å–µ—Å—Ç—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

---

### –¢–ï–°–¢ 2.3: –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ–∫—Ç–æ—Ä–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/users/DOC001/activity?startDate=2025-10-13T12:00:00&endDate=2025-10-13T12:30:00
```

**–ß–¢–û –î–û–õ–ñ–ù–û –í–ï–†–ù–£–¢–¨–°–Ø:**
```json
{
  "userId": "DOC001",
  "userRole": "DOCTOR",
  "totalActions": 4,
  "lastActivity": "2025-10-13T12:28:00",
  "loginCount": 0,
  "failedLoginCount": 0
}
```

**–ü–†–û–í–ï–†–ö–ò:**
- ‚úì –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–µ—Ä–∏–æ–¥–µ
- ‚úì totalActions –º–µ–Ω—å—à–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–µ–π—Å—Ç–≤–∏–π –¥–æ–∫—Ç–æ—Ä–∞

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –¢–ï–°–¢ 2.4: –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/users/NONEXISTENT/activity
```

**–ß–¢–û –î–û–õ–ñ–ù–û –í–ï–†–ù–£–¢–¨–°–Ø:**
```json
{
  "userId": "NONEXISTENT",
  "userRole": "UNKNOWN",
  "totalActions": 0,
  "lastActivity": null,
  "loginCount": 0,
  "failedLoginCount": 0
}
```

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

---

## API ENDPOINT 3: GET /api/analytics/performance

### –û–ø–∏—Å–∞–Ω–∏–µ
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —ç—Å–∫–∞–ª–∞—Ü–∏–∏, –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.

---

### –¢–ï–°–¢ 3.1: –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/performance
```

**–ß–¢–û –î–û–õ–ñ–ù–û –í–ï–†–ù–£–¢–¨–°–Ø:**
```json
{
  "averageProcessingTimeMs": 1234.5,
  "totalRecommendations": 2,
  "approvedRecommendations": 1,
  "rejectedRecommendations": 1,
  "totalEscalations": 1,
  "resolvedEscalations": 1,
  "averageEscalationResolutionTimeMs": 5678.0
}
```

**–ü–†–û–í–ï–†–ö–ò:**
- ‚úì totalRecommendations = approvedRecommendations + rejectedRecommendations
- ‚úì averageProcessingTimeMs > 0
- ‚úì totalEscalations >= resolvedEscalations
- ‚úì averageEscalationResolutionTimeMs > 0

**–ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ –í MONGODB:**
```javascript
// –ü–æ–¥—Å—á–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
db.analytics_events.find({
  eventType: { $in: ["RECOMMENDATION_APPROVED", "RECOMMENDATION_REJECTED"] }
}).count()
// –î–æ–ª–∂–Ω–æ = totalRecommendations

// –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
db.analytics_events.find({
  eventType: "RECOMMENDATION_APPROVED"
}).count()
// –î–æ–ª–∂–Ω–æ = approvedRecommendations

// –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
db.analytics_events.aggregate([
  {
    $match: {
      eventType: { $in: ["RECOMMENDATION_APPROVED", "RECOMMENDATION_REJECTED"] },
      processingTimeMs: { $exists: true }
    }
  },
  {
    $group: {
      _id: null,
      avgTime: { $avg: "$processingTimeMs" }
    }
  }
])
// avgTime –¥–æ–ª–∂–Ω–æ = averageProcessingTimeMs
```

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –≤–µ—Ä–Ω–æ

---

### –¢–ï–°–¢ 3.2: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/performance?startDate=2025-10-13T00:00:00&endDate=2025-10-13T23:59:59
```

**–ü–†–û–í–ï–†–ö–ò:**
- ‚úì –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- ‚úì –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ >= 0

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## API ENDPOINT 4: GET /api/analytics/patients/stats

### –û–ø–∏—Å–∞–Ω–∏–µ
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞–º: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É –∏ –≤–æ–∑—Ä–∞—Å—Ç—É, VAS –∑–∞–ø–∏—Å–∏.

---

### –¢–ï–°–¢ 4.1: –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞–º

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/patients/stats
```

**–ß–¢–û –î–û–õ–ñ–ù–û –í–ï–†–ù–£–¢–¨–°–Ø:**
```json
{
  "totalPatients": 2,
  "patientsByGender": {
    "FEMALE": 1,
    "MALE": 1
  },
  "patientsByAgeGroup": {
    "30-44": 1,
    "45-59": 1
  },
  "totalVasRecords": 7,
  "criticalVasRecords": 2,
  "averageVasLevel": 6.14
}
```

**–ü–†–û–í–ï–†–ö–ò:**
- ‚úì totalPatients = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ PATIENT_REGISTERED —Å–æ–±—ã—Ç–∏–π
- ‚úì patientsByGender: —Å—É–º–º–∞ = totalPatients
- ‚úì patientsByAgeGroup: —Å—É–º–º–∞ = totalPatients
- ‚úì totalVasRecords = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ VAS_RECORDED —Å–æ–±—ã—Ç–∏–π
- ‚úì criticalVasRecords = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ VAS —Å priority="HIGH"
- ‚úì averageVasLevel = —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ vasLevel

**–ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ –í MONGODB:**
```javascript
// –ü–∞—Ü–∏–µ–Ω—Ç—ã
db.analytics_events.find({
  eventType: "PATIENT_REGISTERED"
}).count()
// –î–æ–ª–∂–Ω–æ = totalPatients

// –ü–∞—Ü–∏–µ–Ω—Ç—ã –ø–æ –ø–æ–ª—É
db.analytics_events.aggregate([
  { $match: { eventType: "PATIENT_REGISTERED" } },
  { $group: { _id: "$metadata.gender", count: { $sum: 1 } } }
])
// –î–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å patientsByGender

// VAS –∑–∞–ø–∏—Å–∏
db.analytics_events.find({
  eventType: "VAS_RECORDED"
}).count()
// –î–æ–ª–∂–Ω–æ = totalVasRecords

// –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ VAS
db.analytics_events.find({
  eventType: "VAS_RECORDED",
  priority: "HIGH"
}).count()
// –î–æ–ª–∂–Ω–æ = criticalVasRecords

// –°—Ä–µ–¥–Ω–∏–π VAS
db.analytics_events.aggregate([
  { $match: { eventType: "VAS_RECORDED" } },
  { $group: { _id: null, avg: { $avg: "$vasLevel" } } }
])
// avg –¥–æ–ª–∂–Ω–æ = averageVasLevel
```

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

---

### –¢–ï–°–¢ 4.2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø

**–û–ñ–ò–î–ê–ï–ú–´–ï –ì–†–£–ü–ü–´:**
- "0-17" - –¥–µ—Ç–∏
- "18-29" - –º–æ–ª–æ–¥—ã–µ
- "30-44" - —Å—Ä–µ–¥–Ω–∏–π –≤–æ–∑—Ä–∞—Å—Ç
- "45-59" - –∑—Ä–µ–ª—ã–π –≤–æ–∑—Ä–∞—Å—Ç
- "60-74" - –ø–æ–∂–∏–ª—ã–µ
- "75+" - –æ—á–µ–Ω—å –ø–æ–∂–∏–ª—ã–µ

**–ü–†–û–í–ï–†–ö–ê:**
–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Ä–∞–∑–Ω—ã—Ö –≤–æ–∑—Ä–∞—Å—Ç–æ–≤ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã.

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### –¢–ï–°–¢ 4.3: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥

**–ß–¢–û –î–ï–õ–ê–¢–¨ –í POSTMAN:**
```http
GET http://localhost:8080/api/analytics/patients/stats?startDate=2025-10-13T12:00:00&endDate=2025-10-13T12:20:00
```

**–ü–†–û–í–ï–†–ö–ò:**
- ‚úì –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–∞—Ü–∏–µ–Ω—Ç—ã, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- ‚úì VAS –∑–∞–ø–∏—Å–∏ —Ç–∞–∫–∂–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ –ø–µ—Ä–∏–æ–¥—É

**–ì–ê–õ–û–ß–ö–ê ‚úì:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤

---

## üé® –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –° –§–†–û–ù–¢–ï–ù–î–ê (Dashboard)

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

#### 1. –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (EventStatsDTO)
**–ì–î–ï –°–ú–û–¢–†–ï–¢–¨:** –ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å –¥–∞—à–±–æ—Ä–¥–∞

**–ß–¢–û –î–û–õ–ñ–ù–û –û–¢–û–ë–†–ê–ñ–ê–¢–¨–°–Ø:**
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π (—á–∏—Å–ª–æ)
- –ì—Ä–∞—Ñ–∏–∫/–¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø–∞–º
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–æ–ª—è–º (pie chart)
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º

**–ü–†–û–í–ï–†–ö–ê:**
- ‚úì –ß–∏—Å–ª–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å API –æ—Ç–≤–µ—Ç–æ–º
- ‚úì –ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–µ—Ä–∏–æ–¥–∞
- ‚úì –¶–≤–µ—Ç–∞ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π

---

#### 2. –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–ì–î–ï –°–ú–û–¢–†–ï–¢–¨:** –†–∞–∑–¥–µ–ª "User Activity"

**–ß–¢–û –î–û–õ–ñ–ù–û –û–¢–û–ë–†–ê–ñ–ê–¢–¨–°–Ø:**
- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–∏–Ω–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞

**–ü–†–û–í–ï–†–ö–ê:**
- ‚úì –î–∞–Ω–Ω—ã–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å API
- ‚úì –í—Ä–µ–º—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- ‚úì –ú–æ–∂–Ω–æ –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

---

#### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
**–ì–î–ï –°–ú–û–¢–†–ï–¢–¨:** –†–∞–∑–¥–µ–ª "Performance Metrics"

**–ß–¢–û –î–û–õ–ñ–ù–û –û–¢–û–ë–†–ê–ñ–ê–¢–¨–°–Ø:**
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö/–æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç—Å–∫–∞–ª–∞—Ü–∏–π
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —ç—Å–∫–∞–ª–∞—Ü–∏–π

**–ü–†–û–í–ï–†–ö–ê:**
- ‚úì –ú–µ—Ç—Ä–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úì –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç—Ä–µ–Ω–¥—ã
- ‚úì –í—Ä–µ–º—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (—Å–µ–∫—É–Ω–¥—ã/–º–∏–Ω—É—Ç—ã)

---

#### 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
**–ì–î–ï –°–ú–û–¢–†–ï–¢–¨:** –†–∞–∑–¥–µ–ª "Patient Analytics"

**–ß–¢–û –î–û–õ–ñ–ù–û –û–¢–û–ë–†–ê–ñ–ê–¢–¨–°–Ø:**
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É (pie chart)
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –≥—Ä—É–ø–ø–∞–º (bar chart)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ VAS –∑–∞–ø–∏—Å–µ–π
- –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –±–æ–ª–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª—É—á–∞–µ–≤

**–ü–†–û–í–ï–†–ö–ê:**
- ‚úì Pie chart –¥–ª—è –ø–æ–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏
- ‚úì Bar chart –¥–ª—è –≤–æ–∑—Ä–∞—Å—Ç–æ–≤ —á–∏—Ç–∞–µ–º—ã–π
- ‚úì –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–ª—É—á–∞–∏ –≤—ã–¥–µ–ª–µ–Ω—ã –∫—Ä–∞—Å–Ω—ã–º
- ‚úì –°—Ä–µ–¥–Ω–∏–π VAS –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å 2 –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ß–ê–°–¢–¨ 2A: API –°–¢–ê–¢–ò–°–¢–ò–ö–ò

- [ ] GET /api/analytics/events/stats –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è events/stats
- [ ] GET /api/analytics/users/{userId}/activity –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- [ ] –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç UNKNOWN
- [ ] GET /api/analytics/performance –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] GET /api/analytics/patients/stats –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
- [ ] –í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ VAS –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ HIGH priority
- [ ] –°—Ä–µ–¥–Ω–∏–π VAS —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –≤–µ—Ä–Ω–æ
- [ ] –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –¥–∞—Ç–∞–º
- [ ] –î–∞—à–±–æ—Ä–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- [ ] –ß–∏—Å–ª–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å API

**–ï–°–õ–ò –í–°–ï –ì–ê–õ–û–ß–ö–ò –ü–†–û–°–¢–ê–í–õ–ï–ù–´** ‚úÖ - –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ PART 2B: –°–æ–±—ã—Ç–∏—è –∏ –ª–æ–≥–∏
